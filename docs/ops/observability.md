# Zist Observability Stack

## Components
1. Prometheus (`:9090`) for metrics and alert evaluation.
2. Blackbox exporter (`:9115`) for synthetic health probes.
3. Grafana (`:3001`, `admin/admin`) with preloaded `Zist SRE Overview` dashboard.
4. OpenTelemetry Collector (`:4317`) for trace ingestion.
5. Tempo (`:3200`) for trace storage.

## Start / stop
```bash
# Start zist app stack first
MASHGATE_API_KEY=dev-local-key \
SESSION_SECRET=dev-session-secret \
INTERNAL_TOKEN=dev-internal-token \
MASHGATE_WEBHOOK_SECRET=dev-whsec \
docker compose -f /Users/saidmashhud/Projects/personal/zist/docker-compose.yml up -d

# Enable trace export from services to collector
export OTEL_EXPORTER_OTLP_ENDPOINT=otel-collector:4317
export OTEL_EXPORTER_OTLP_INSECURE=true

# Start observability overlay
make -C /Users/saidmashhud/Projects/personal/zist ops-up
```

```bash
# Stop observability overlay
make -C /Users/saidmashhud/Projects/personal/zist ops-down
```

## Alert rules
Rules are defined in:
- `/Users/saidmashhud/Projects/personal/zist/ops/prometheus/alert_rules.yml`

They cover:
1. hard down detection,
2. elevated p95 probe latency,
3. health probe flapping.

## Tracing notes
1. Traces are generated by gateway/listings/bookings/payments middleware.
2. Cross-service propagation is enabled for:
   - gateway reverse proxy requests,
   - bookings -> listings internal client,
   - payments -> bookings internal client.
3. If `OTEL_EXPORTER_OTLP_ENDPOINT` is empty, tracing is disabled (no-op exporter).
